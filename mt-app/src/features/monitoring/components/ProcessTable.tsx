import { useTranslation } from 'react-i18next';
import { MaterialIcon } from '../../../components/common';
import { useMonitoringProcesses } from '../../../hooks/useData';
import { processStatusConfig } from '../../../mocks/configs';
import { TableSkeleton } from '../../../components/skeleton';

interface ProcessTableProps {
  hostId: string;
}

export function ProcessTable({ hostId }: ProcessTableProps) {
  const { t } = useTranslation();
  const { data: processes, loading } = useMonitoringProcesses(hostId);

  if (loading) {
    return <TableSkeleton rows={4} columns={6} />;
  }

  return (
    <>
      {/* Header */}
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-slate-900 dark:text-white text-2xl font-bold tracking-tight">
          {t('monitoring.processes.title')}
        </h2>
        <button className="text-primary text-sm font-bold hover:underline">
          {t('monitoring.processes.viewAll')}
        </button>
      </div>

      {/* Table */}
      <div className="overflow-hidden rounded-xl border border-slate-200 dark:border-[#3b4754] bg-white dark:bg-[#1e293b]/30">
        <table className="w-full text-left">
          <thead className="bg-slate-50 dark:bg-[#283039]/50 border-b border-slate-200 dark:border-[#3b4754]">
            <tr>
              <th className="px-6 py-4 text-xs font-bold text-slate-500 dark:text-[#9dabb9] uppercase tracking-wider">
                {t('monitoring.processes.name')}
              </th>
              <th className="px-6 py-4 text-xs font-bold text-slate-500 dark:text-[#9dabb9] uppercase tracking-wider">
                {t('monitoring.processes.pid')}
              </th>
              <th className="px-6 py-4 text-xs font-bold text-slate-500 dark:text-[#9dabb9] uppercase tracking-wider">
                {t('monitoring.processes.cpu')}
              </th>
              <th className="px-6 py-4 text-xs font-bold text-slate-500 dark:text-[#9dabb9] uppercase tracking-wider">
                {t('monitoring.processes.memory')}
              </th>
              <th className="px-6 py-4 text-xs font-bold text-slate-500 dark:text-[#9dabb9] uppercase tracking-wider">
                {t('monitoring.processes.status')}
              </th>
              <th className="px-6 py-4 text-xs font-bold text-slate-500 dark:text-[#9dabb9] uppercase tracking-wider text-right">
                {t('monitoring.processes.actions')}
              </th>
            </tr>
          </thead>
          <tbody className="divide-y divide-slate-200 dark:divide-[#3b4754]">
            {(processes || []).map((process) => (
              <tr
                key={process.id}
                className="hover:bg-slate-50 dark:hover:bg-primary/5 transition-colors"
              >
                <td className="px-6 py-4 flex items-center gap-3">
                  <MaterialIcon name={process.icon} className="text-primary" />
                  <span className="font-semibold text-slate-900 dark:text-white">
                    {process.name}
                  </span>
                </td>
                <td className="px-6 py-4 font-mono text-sm text-slate-500 dark:text-[#9dabb9] tabular-nums">
                  {process.pid}
                </td>
                <td
                  className={`px-6 py-4 font-bold tabular-nums ${process.cpuHighlight
                    ? 'text-lime-500 dark:text-lime-400'
                    : 'text-slate-900 dark:text-white'
                    }`}
                >
                  {process.cpu}
                </td>
                <td className="px-6 py-4 font-mono text-slate-900 dark:text-white tabular-nums">
                  {process.memory}
                </td>
                <td className="px-6 py-4">
                  <span
                    className={`px-2 py-0.5 rounded text-[10px] font-bold ${processStatusConfig[process.status]}`}
                  >
                    {process.status}
                  </span>
                </td>
                <td className="px-6 py-4 text-right">
                  <button className="text-red-400 hover:text-red-500 font-bold text-xs uppercase">
                    {t('monitoring.processes.terminate')}
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </>
  );
}
